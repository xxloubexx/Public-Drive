BIND9

--------------INT1-----------------

etc/bind/named.conf.local
zone "aforp.org" {
	file "/var/cache/bind/aforp.db";
	type master;
};
zone "patiobrancion.com" {
	type forward;
	forwarders { 10.1.20.1;10.1.20.2;10.1.20.3;}
};

cd /etc/bind
cp db.0 /var/cache/bind/aforp.db
aforp.db :
@ IN SOA aforp.org admin.aforp.org
@ IN NS int1.aforp.org.
@ IN MX 10 dmz3.aforp.org.
DMZ3 IN A 10.1.20.3
RTR1 IN A 10.1.10.254
INT1 IN A 10.1.10.1
RTR1 IN AAAA 2001:db8:1001:10::9
INT1 IN AAAA 2001:db8:1001:10::1
imap IN A 10.1.20.3
smtp IN A 10.1.20.3


/etc/bind/named.conf.options
dnssec-validation no;
allow-recursion { any;};

--------------DMZ2------------------
/etc/bind/named.conf
#include "/etc/bind/named.conf.default-zones";
etc/bind/named.conf.local

acl lan {10.1.10.0/24; 10.1.20.0/24; 127.0.0.1;};
acl wan {any;};

view "lan" {
	match-clients {lan;};
	zone "patiobrancion.com" {
		file "/var/cache/bind/patio.db";
		type master;
		allow-transfer {10.1.20.3;}; #Autoriser le slave a communiquer avec le master
	};
	zone "aforp.org" {
		type forward;
		forwarders { 10.1.10.1;};
	};
};

view "wan" {
	match-clients {wan;};
	zone "patiobrancion.com" {
		file "/var/cache/bind/patio-ext.db";
		type master;
		allow-transfer {10.1.20.3;}; #Autoriser le slave a communiquer avec le master
	};
	zone "aforp.org" {
		type forward;
		forwarders { 10.1.10.1;};
	};
};


cd /etc/bind
cp db.0 /var/cache/bind/patio.db
patio.db :
@ IN SOA patiobrancion.com admin.patiobrancion.com
@ IN NS dmz2.patiobrancion.com.
@ IN MX 10 mail.patiobrancion.com.
mail IN A 10.1.20.2
DMZ1 IN A 10.1.20.1
DMZ2 IN A 10.1.20.2
DMZ3 IN A 10.1.20.3
DMZ1 IN AAAA 2001:db8:1001:20::1
DMZ2 IN AAAA 2001:db8:1001:20::2
DMZ3 IN AAAA 2001:db8:1001:20::3
admin IN A 10.1.20.1
admin IN AAAA 2001:db8:1001:20::1
home IN A 10.1.20.1
home IN AAAA 2001:db8:1001:20::1
room IN A 10.1.20.2
room IN AAAA 2001:db8:1001:20::2
book IN A 10.1.20.3
book IN AAAA 2001:db8:1001:20::3

cp patio.db patio-ext.db
DMZ IN A 43.92.142.17
home IN A 43.92.142.17
room IN A 43.92.142.17
book IN A 43.92.142.17
admin IN A 43.92.142.17
imap IN A 43.92.142.17
smtp IN A 43.92.142.17


/etc/bind/named.conf.options
dnssec-validation no;
allow-recursion { any;};


------------------DMZ3------------------
mkdir /etc/bind/slaves
/etc/bind/named.conf.local
zone "patiobrancion.com" {
	type slave;
	file "/var/cache/bind/patio.db";
	masters { 10.1.20.2;};
};
zone "aforp.org" {
	type forward;
	forwarders { 10.1.10.1;};
	};

/etc/bind/named.conf.options
dnssec-validation no;
allow-recursion { any;};
--------------------------------------


